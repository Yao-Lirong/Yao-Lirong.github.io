<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <p>大概是写这么多年 C(++) 以来第一次正式学 C (虽然其实在康奈尔学过一遍C++)</p> <p><span id="more"></span>&lt;h2 id="Compiling-C-Program"&gt;<a href="#Compiling-C-Program" class="headerlink" title="Compiling C Program"></a>Compiling C Program&lt;/h2&gt;<figure class="highlight bash">&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;<span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;<span class="line"><span class="comment"># compile hello.c and name the executable as default (a.out)</span></span><br><span class="line">gcc hello.c</span><br><span class="line"></span><br><span class="line"><span class="comment"># compile hello.c and name the output executable "sayhello"</span></span><br><span class="line">gcc hello.c -o sayhello</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</figure>&lt;p&gt;We usually write <code>return 0</code>, this exit code 0 means <code>EXIT_SUCCESS</code>.&lt;/p&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Prototype&lt;/th&gt;&lt;th&gt;Definition&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;prototype - declare a function (write down its name)&lt;/td&gt;&lt;td&gt;definition - define a function (write down its content)&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;<code>.h</code> stand for “header” and it contains prototype of function&lt;/td&gt;&lt;td&gt;<code>.c</code> stand for “code” and it contains definition of function&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;h2 id="Complex-amp-Custom-Data-Types"&gt;<a href="#Complex-amp-Custom-Data-Types" class="headerlink" title="Complex &amp; Custom Data Types"></a>Complex &amp; Custom Data Types&lt;/h2&gt;&lt;h3 id="struct"&gt;<a href="#struct" class="headerlink" title="struct"></a>struct&lt;/h3&gt;<figure class="highlight c">&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;<span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;<span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rect_t</span> {</span></span><br><span class="line"> <span class="keyword">int</span> left;</span><br><span class="line"> … }; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rect_t</span> <span class="title">myRect</span>;</span></span><br>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</figure>&lt;h3 id="typedef"&gt;<a href="#typedef" class="headerlink" title="typedef"></a>typedef&lt;/h3&gt;&lt;p&gt;The keyword <code>typedef</code> allows a programmer to create a new type.&lt;/p&gt;<figure class="highlight c">&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;<span class="line">1</span><br><span class="line">2</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;<span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">rect_t</span> {</span> … };</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">rect_t</span> <span class="title">rect_t</span>;</span></span><br>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</figure>&lt;p&gt;Now we can create instance of the new type: (Note how this is different from a struct instance declaration)&lt;/p&gt;<figure class="highlight c">&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;<span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;<span class="line"><span class="keyword">rect_t</span> myRect;</span><br><span class="line">myRect.left = <span class="number">1</span>;</span><br><span class="line">…</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</figure>&lt;h2 id="Strings"&gt;<a href="#Strings" class="headerlink" title="Strings"></a>Strings&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;<code>char *strstr(const char *haystack, const char *needle)</code>: finds the first occurrence of the substring <strong>needle</strong> in the string <strong>haystack</strong>.&lt;/li&gt;&lt;li&gt;<code>sprintf(char *str, const char *format, ...)</code>: “prints out” formatted output to a string <strong>str</strong>, but instead of really printing them out, <code>sprintf</code> buffers the output to the string.(<code>sprintf(str, "Pi = %f", 3.14);</code> will set <code>str</code> to be <code>Pi = 3.14</code>)&lt;/li&gt;&lt;/ul&gt;&lt;h2 id="Dynamic-Memory-Allocation"&gt;<a href="#Dynamic-Memory-Allocation" class="headerlink" title="Dynamic Memory Allocation"></a>Dynamic Memory Allocation&lt;/h2&gt;&lt;p&gt;Consider the following program:&lt;/p&gt;<figure class="highlight c">&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;<span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;<span class="line"><span class="function"><span class="keyword">int</span> * <span class="title">initArray</span><span class="params">(<span class="keyword">int</span> howLarge)</span> </span>{</span><br><span class="line"> <span class="keyword">int</span> myArray[howLarge];</span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; howLarge; i++) myArray[i] = i;</span><br><span class="line"> <span class="keyword">return</span> myArray; }</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</figure>&lt;p&gt;We cannot do this because the space allocated to <code>myArray</code> is only inside the scope of <code>initArray</code> and will be freed once we exit this function. So what we want is <em>dynamic memory allocation</em> so the memory will be allocated at a dynamic heap instead of the call stack. &lt;/p&gt;<figure class="highlight c">&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;<span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;<span class="line"><span class="keyword">int</span> *p = <span class="built_in">malloc</span>(<span class="number">6</span> * <span class="keyword">sizeof</span>(<span class="keyword">int</span>)); <span class="comment">// memory allocation</span></span><br><span class="line">p = <span class="built_in">realloc</span>(p, <span class="number">12</span> * <span class="keyword">sizeof</span>(<span class="keyword">int</span>)); <span class="comment">// re-allocation</span></span><br><span class="line"><span class="built_in">free</span>(p);</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</figure>&lt;p&gt;We can then rewrite the above function as:&lt;/p&gt;<figure class="highlight c">&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;<span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;<span class="line"><span class="function"><span class="keyword">int</span> * <span class="title">initArray</span><span class="params">(<span class="keyword">int</span> howLarge)</span> </span>{</span><br><span class="line"> <span class="keyword">int</span> *myArray = <span class="built_in">malloc</span>(howLarge * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; howLarge; i++) myArray[i] = i;</span><br><span class="line"> <span class="keyword">return</span> myArray; }</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</figure>&lt;p&gt;Note the following when you use <code>free</code>: &lt;/p&gt;<figure class="highlight c">&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;<span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;<span class="line"><span class="comment">// you cannot free something on the stack</span></span><br><span class="line"><span class="keyword">int</span> x = <span class="number">3</span>; <span class="keyword">int</span> *p = &amp;x;</span><br><span class="line"><span class="built_in">free</span>(p); <span class="comment">// early termination</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// free can only be used to free address returned by malloc</span></span><br><span class="line"><span class="keyword">int</span> <em>p = <span class="built_in">malloc</span>(<span class="number">4</span></em><span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">p++;</span><br><span class="line"><span class="built_in">free</span>(p); <span class="comment">// early termination</span></span><br>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</figure>&lt;h2 id="Debugging-C-in-VSCode"&gt;<a href="#Debugging-C-in-VSCode" class="headerlink" title="Debugging C in VSCode"></a>Debugging C in VSCode&lt;/h2&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Install the extension “GDB Debugger - Beyond” &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Replace what’s in <code>launch.json - configurations</code> with the following codes:&lt;/p&gt;<figure class="highlight json">&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;<span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;<span class="line"><span class="string">"configurations"</span>: [</span><br><span class="line"> {</span><br><span class="line"> <span class="attr">"type"</span>: <span class="string">"by-gdb"</span>,</span><br><span class="line"> <span class="attr">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line"> <span class="attr">"name"</span>: <span class="string">"Launch(gdb)"</span>,</span><br><span class="line"> <span class="attr">"program"</span>: <span class="string">"${fileDirname}/${fileBasenameNoExtension}"</span>,</span><br><span class="line"> <span class="attr">"cwd"</span>: <span class="string">"${workspaceRoot}"</span></span><br><span class="line"> }</span><br><span class="line">]</span><br>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</figure>&lt;/li&gt;&lt;/ol&gt;</p> </body></html>