<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <h2 id="Initial-Server-Setup"> <a href="#Initial-Server-Setup" class="headerlink" title="Initial Server Setup"></a><a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04" rel="external nofollow noopener" target="_blank">Initial Server Setup</a> </h2> <h3 id="Logging-In"> <a href="#Logging-In" class="headerlink" title="Logging In"></a>Logging In</h3> <ol> <li>We chose “use ssh keys to log in” when creating the server, so we need to first get our root password by “reset root password”. Next time when you log in, you will be prompted to change password. </li> <li>log into server <code>ssh root@your_server_ip</code>. Passphrase set when creating ssh keys are needed. </li> </ol> <h3 id="Adding-User"> <a href="#Adding-User" class="headerlink" title="Adding User"></a>Adding User</h3> <ol> <li><p><a href="https://www.makeuseof.com/linux-list-users/" rel="external nofollow noopener" target="_blank">Check currently available users</a> with <code>cat /etc/passwd</code> </p></li> <li> <p>Add a new user with <code>adduser &lt;username&gt;</code></p> <p>If a wrong user is added accidentally, delete it with <code>deluser &lt;username&gt;</code></p> </li> <li><p>Grant this newly added user sudo privilege by “appending” it to sudo “Group” <code>usermod -aG sudo &lt;username&gt;</code></p></li> </ol> <h3 id="Logging-in-as-New-User"> <a href="#Logging-in-as-New-User" class="headerlink" title="Logging in as New User"></a>Logging in as New User</h3> <p>We can log in with the following two ways: </p> <ul> <li> <p><a href="https://serverpilot.io/docs/how-to-enable-ssh-password-authentication/" rel="external nofollow noopener" target="_blank">Enabling ssh password login</a>:</p> <ol> <li>go to <code>/etc/ssh/sshd_config</code> and change <code>PasswordAuthentication no</code> to <code>PasswordAuthentication yes</code>. </li> <li>Restart the service after editing <code>sudo service ssh restart</code>. </li> </ol> </li> <li> <p>Continue use SSH Authentication:</p> <p>We want to copy the keys with the correct ownership and permissions, so use <code>rsync --archive --chown=sammy:sammy ~/.ssh /home/sammy</code> (Replace “sammy” with your username)</p> <ul> <li> <a href="https://serverfault.com/questions/141773/what-is-archive-mode-in-rsync/141778#141778" rel="external nofollow noopener" target="_blank">explains what –archive does</a> </li> <li> <code>--chown=USER:GROUP</code> forces all files to be owned by USER with group GROUP</li> <li>be sure that the source directory (<code>~/.ssh</code>) <strong>does not</strong> include a trailing slash (check to make sure you are not using <code>~/.ssh/</code>) If you accidentally add a trailing slash to the command, <code>rsync</code> will copy the <em>contents</em> of the <strong>root</strong> account’s <code>~/.ssh</code> directory to the <code>sudo</code> user’s home directory instead of copying the entire <code>~/.ssh</code> directory structure.</li> </ul> </li> </ul> <p>We can now log in as the newly added user <code>&lt;username&gt;@your_server_ip</code> </p> <h2 id="Setting-up-Firewall"> <a href="#Setting-up-Firewall" class="headerlink" title="Setting up Firewall"></a><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-20-04" rel="external nofollow noopener" target="_blank">Setting up Firewall</a> </h2> <p>Before everything, you should check IPV6 is enabled by going to <code>nano /etc/default/ufw</code> and check <code>IPV6=yes</code>.</p> <ol> <li> <p>Set up a default profile to deny all incoming and allow all outgoing.</p> <figure class="highlight bash"><table><tr> <td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td> <td class="code"><pre><span class="line">ufw default deny incoming</span><br><span class="line">ufw default allow outgoing</span><br></pre></td> </tr></table></figure> </li> <li> <p>This is enough for a PC but not enough for a server. We would need to allow ssh, HTTP, and HTTPS.</p> <figure class="highlight bash"><table><tr> <td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td> <td class="code"><pre><span class="line">ufw allow ssh</span><br><span class="line">ufw allow http</span><br><span class="line">ufw allow https </span><br></pre></td> </tr></table></figure><p>The Firewall will then allow traffic from the default ports specified by these applications. For example, <code>ssh</code> uses port 22, so <code>ufw allow ssh</code> is equivalent to <code>ufw allow 22</code>. </p> </li> <li> <p>Enable and check firewall’s status:</p> <figure class="highlight bash"><table><tr> <td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td> <td class="code"><pre><span class="line">ufw <span class="built_in">enable</span></span><br><span class="line">ufw status verbose</span><br></pre></td> </tr></table></figure> </li> </ol> <p>For more commands related to UFW, check <a href="https://www.digitalocean.com/community/tutorials/ufw-essentials-common-firewall-rules-and-commands" rel="external nofollow noopener" target="_blank">UFW Essentials</a>.</p> <h2 id="Install-PHP"> <a href="#Install-PHP" class="headerlink" title="Install PHP"></a>Install PHP</h2> <ol> <li>安装php，可用想要安装的版本替换 “7.4”: <code>apt install php7.4-cli</code> </li> <li>安装所需要的插件，可以通过 <code>aptitude search php7.4 |grep -i mysql</code> 来寻找对应的插件（可用自己需要的 mbstring, GD, 等替换 mysql）</li> </ol> <p>conf.d - individual site configuration stored here</p> </body></html>